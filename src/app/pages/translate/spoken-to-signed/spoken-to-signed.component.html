<div class="translation-text">
  <label id="spoken-language-label">{{ 'translate.spoken-to-signed.text' | transloco }}</label>
  <textarea
    [formControl]="text"
    [maxLength]="maxTextLength"
    dir="auto"
    [lang]="spokenLanguage"
    aria-labelledby="spoken-language-label"
    autofocus
    data-gramm_editor="false"></textarea>
  <div class="actions">
    <app-speech-to-text [lang]="spokenLanguage" (changeText)="text.setValue($event)"></app-speech-to-text>
    <app-text-to-speech [lang]="spokenLanguage" [text]="text.value"></app-text-to-speech>
    <div id="char-count">{{ text.value.length | number }} / {{ maxTextLength | number }}</div>
  </div>
</div>
<app-sign-writing [signs]="signWriting$ | async"></app-sign-writing>

<div class="sign-language">
  <ng-container *ngIf="videoUrl; else noVideo">
    <video
      [src]="videoUrl"
      autoplay
      loop
      muted
      playsinline
      height="100%"
      width="100%"
      (click)="playVideoIfPaused($event)"></video>
  </ng-container>
  <ng-template #noVideo>
    <ng-container *ngIf="pose$ | async as pose; else noPose">
      <ng-container *ngIf="poseViewerSetting$ | async as poseViewerSetting">
        <app-skeleton-pose-viewer *ngIf="poseViewerSetting === 'pose'" [src]="pose"></app-skeleton-pose-viewer>
        <app-human-pose-viewer *ngIf="poseViewerSetting === 'person'" [src]="pose"></app-human-pose-viewer>
        <app-avatar-pose-viewer *ngIf="poseViewerSetting === 'avatar'" [src]="pose"></app-avatar-pose-viewer>
      </ng-container>
    </ng-container>
    <ng-template #noPose></ng-template>
  </ng-template>

  <div class="actions" *ngIf="pose$ | async as pose">
    <ng-container *ngIf="videoUrl; else spinner">
      <ion-button
        class="circle-icon"
        fill="clear"
        shape="round"
        color="dark"
        (click)="downloadTranslation()"
        [attr.aria-label]="'translate.spoken-to-signed.actions.download' | transloco"
        [matTooltip]="'translate.spoken-to-signed.actions.download' | transloco"
        [matTooltipPosition]="'above'">
        <ion-icon name="download-outline" slot="icon-only"></ion-icon>
      </ion-button>

      <ion-button
        class="circle-icon"
        fill="clear"
        shape="round"
        color="dark"
        (click)="shareTranslation()"
        [attr.aria-label]="'translate.spoken-to-signed.actions.share' | transloco"
        [matTooltip]="'translate.spoken-to-signed.actions.share' | transloco"
        [matTooltipPosition]="'above'">
        <ion-icon [name]="shareIcon()" slot="icon-only"></ion-icon>
      </ion-button>
    </ng-container>
    <ng-template #spinner>
      <ion-button [disabled]="true" class="circle-icon" fill="clear" shape="round">
        <ion-spinner name="crescent" color="dark"></ion-spinner>
      </ion-button>
    </ng-template>
    <app-viewer-selector></app-viewer-selector>
  </div>
</div>
